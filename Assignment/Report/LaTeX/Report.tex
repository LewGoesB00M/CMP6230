% -------------------------------------------------------------------------------
% Establish page structure & font.
\documentclass[12pt]{report}

\usepackage[total={6.5in, 9in},
	left=1in,
	right=1in,
	top=1in,
	bottom=1in,]{geometry} % Page structure

\usepackage{graphicx} % Required for inserting images
\graphicspath{{../../.images/}} % Any additional images I use (BCU logo, etc) are from here.

\usepackage[utf8]{inputenc} % UTF-8 encoding
\usepackage[T1]{fontenc} % T1 font
\usepackage{float}  % Allows for floats to be positioned using [H], which correctly
                    % positions them relative to their location within my LaTeX code.
\usepackage{subcaption}

% -------------------------------------------------------------------------------
% Declare biblatex with custom Harvard BCU styling for referencing.
\usepackage[
    useprefix=true,
    maxcitenames=3,
    maxbibnames=99,
    style=authoryear,
    dashed=false, 
    natbib=true,
    url=false,
    backend=biber
]{biblatex}

% Additional styling options to ensure Harvard referencing format.
\renewbibmacro*{volume+number+eid}{
    \printfield{volume}
    \setunit*{\addnbspace}
    \printfield{number}
    \setunit{\addcomma\space}
    \printfield{eid}}
\DeclareFieldFormat[article]{number}{\mkbibparens{#1}}

% Declaring both bib sources.
% Pipeline is the original one copied from draft pipeline, Report is new for this.
% This is because pipeline.bib is over a thousand lines long.
\addbibresource{Pipeline.bib}
\addbibresource{Report.bib}

% -------------------------------------------------------------------------------
% To prevent "Chapter N" display for each chapter
\usepackage[compact]{titlesec}
\usepackage{wasysym}
\usepackage{import}

\titlespacing*{\chapter}{0pt}{-2cm}{0.5cm}
\titleformat{\chapter}[display]
{\normalfont\bfseries}{}{0pt}{\Huge}

% -------------------------------------------------------------------------------
% Custom macro to make an un-numbered footnote.

\newcommand\blfootnote[1]{
    \begingroup
    \renewcommand\thefootnote{}\footnote{#1}
    \addtocounter{footnote}{-1}
    \endgroup
}

% -------------------------------------------------------------------------------
% Fancy headers; used to show my name, BCU logo and current chapter for the page.
\usepackage{fancyhdr}
\usepackage{calc}
\pagestyle{fancy}

\setlength\headheight{37pt} % Set custom header height to fit the image.

\renewcommand{\chaptermark}[1]{%
    \markboth{#1}{}} % Include chapter name.


% Lewis Higgins - ID 22133848           [BCU LOGO]                [CHAPTER NAME]
\lhead{Lewis Higgins - ID 22133848~~~~~~~~~~~~~~~\includegraphics[width=1.75cm]{BCU}}
\fancyhead[R]{\leftmark}

% ------------------------------------------------------------------------------
% Used to add PDF hyperlinks for figures and the contents page.

\usepackage{hyperref}

\hypersetup{
    colorlinks=true,
    linkcolor=black,
    filecolor=magenta,
    urlcolor=blue,
    citecolor=black,
}

% ------------------------------------------------------------------------------
\usepackage{xcolor} 
\usepackage{colortbl}
\usepackage{longtable}
\usepackage{amssymb}
% ------------------------------------------------------------------------------
\usepackage{tcolorbox}
\newcommand{\para}{\vspace{7pt}\noindent}
% -------------------------------------------------------------------------------

\title{Data Management and MLOps Activities Log Report}
\author{Lewis Higgins - Student ID 22133848}
\date{December 2024}

% -------------------------------------------------------------------------------

\begin{document}


\makeatletter
\begin{titlepage}
    \begin{center}
        \includegraphics[width=0.7\linewidth]{BCU}\\[4ex]
        {\huge \bfseries CMP6230 - Assignment 2}\\[2ex]
        {\large \bfseries  \@title}\\[50ex]
        {\@author}\\[2ex]
        {CMP6230 - Data Management and Machine Learning Operations}\\[2ex]
        {Module Coordinator: Sima Iranmanesh}\\[10ex]
    \end{center}
\end{titlepage}
\makeatother
\thispagestyle{empty}
\newpage


% Page counter trick so that the contents page doesn't increment it.
\setcounter{page}{0}

\tableofcontents
\thispagestyle{empty}

\chapter*{Introduction}
\addcontentsline{toc}{chapter}{Introduction}
% UPDATE INTRO BECAUSE THE REPORT ISN'T JUST A PLAN ANYMORE.
This report aims to design and document a five-stage Machine Learning Operations pipeline, from the initial 
data ingestion to the monitoring of the produced model, beginning 
with the identification of three candidate datasets for the pipeline to be conducted with, and continuing 
into descriptions of what each stage of the pipeline consists of, and how it will be implemented with the
one chosen dataset using a wide variety of software that is also used within industry. When this plan 
is implemented at a later stage, it will provide a clear framework to create an automated MLOps pipeline
with continuous integration and deployment.

% Importing the sections from the original report here.
\include{Datasets.tex}
\include{PipelineStages.tex}
% Side-note: I think this actually builds immensely faster because it's not recompiling those two every time,
% it just stores the processed version in the .aux files to be instantly reused.


% Apparently this can only go 500 words over the word count. You are already past that with the inclusion 
% of those two TeX files. She doesn't seem massively strict over it though, stating "it's just a module".
% 2012 + 3597 + This word count, unless you change either Datasets.tex or PipelineStages.tex.
% 5609 + This

\section{Data terminology}\label{sec:dataTerms} % Poor section title, consider something else.
This project must take into account four key elements of data handling these being data privacy, security, 
ethics and data protection laws. 

\begin{longtable}{ | p{0.2\textwidth} | p{0.7\textwidth} |}
    \hline
    \cellcolor{blue!25}Term & \cellcolor{blue!25}Description\\
    \hline
    Data privacy & An individual's ability to govern what happens to their personal data \autocite{cloudflare_what_nodate}. Personal data 
    refers to data that could be used to singularly identify someone \autocite{yang_big_2021}.\\
    \hline
    Data security & The protection of personal/sensitive information from unauthorized access, use or manipulation \autocite{ibm_security_2021}.
    This can be the physical protection of material such as hard drives, and software protections like encryption. \\
    \hline
    Data ethics & A blanket term encompassing the moral obligations of data collection, use and protection \autocite{harvard_business_school_5_2021}.
    Ethical data storage would mean that the data subjects willingly gave their data and can ask for its deletion at any point. 
    Mandated by data protection legislation. \\
    \hline 
    Big data ethics & The application of data ethics to massive datasets, concerning the implications of their collection and use on society as a whole
    \autocite{richards_big_2014}. \\ % Poor definition I think, maybe rewrite this one.
    \hline 
    General Data \newline Protection \newline Regulations (GDPR) & Legislation introduced in the EU in 2016, giving individuals significantly more 
    rights over their personal data. Data subjects most notably may request a copy of their data, the removal of their data, and to object to their data's 
    collection \autocite{ico_guide_2024}. Additionally, data must be kept secure using all available means. Companies who fail to adhere to these policies
    face significant sanctions of \euro10,000,000 or 2\% of the company's annual turnover for minor violations, or double this (\euro20,000,000, 4\% turnover)
    for major violations, whichever figure is higher. \\
    \hline
    Data Protection Act 2018 & When the UK left the EU, the GDPR no longer applied. Therefore, the UK adopted the GDPR as an amendment to its own
    Data Protection Act. There are minimal differences between the two, only that the UK's fines are in GBP rather than Euros, meaning fines go up 
    to \pounds17,500,000 or 4\% turnover \autocite{ico_enforcement_2024}. \\
    \hline
\caption{A brief overview of relevant data terminology.}\label{tab:dataTerms}
% Maybe it shouldn't be "brief". I think GDPR especially needs its own paragraph moreso than a table column.
\end{longtable}


\chapter{Implementing the MLOps Pipeline}
\section{Ethical and Legal Considerations}
The dataset was shared under an Apache 2.0 open-source licence, permitting access and modification with no restrictions
except crediting the original author \autocite{apache_apache_nodate}, meaning that there are not any ethical or legal 
considerations of note with this dataset's usage. Given that the chosen dataset also consists of synthetic data,
there are fewer necessary considerations for its use.

\subsection{Synthetic data}
% What is Synthetic Data and what are the common methods that are currently leveraged to attempt
% to perform Synthetic Data Generation?
This term has been frequently used throughout the report to describe the Loan Approval Classification Dataset, and refers to 
data that has been generated algorithmically rather than collected from a real source. However, the generation of the 
synthetic data does often depend on real data to identify patterns and trends, meaning that legislation such as GDPR is still relevant
in those scenarios because the generated data must be impossible to link back to the original subject \autocite{Lopez2022OnTL}.
An example of synthetic data generation is SMOTE, which was used in the generation of the loan dataset \autocite{zoppelleto_financial_nodate}, 
which creates synthetic data in a dataset based on the other rows as previously mentioned in Section \ref{sec:Dataset}. SMOTE will also be used in Section 
\ref{sec:ImpPreprocessing} to balance the dataset.

\subsection{Model drift}
Model drift is a phenomenon that affects deployed production machine learning models where changes in 
their environment over time affects their performance \autocite{nigenda_amazon_2022}. Model drift is not an 
immediate occurrence, and can take a long time to occur, emphasising the importance of continuous integration and deployment. 
Table \ref{tab:Drift} details the different kinds of model drift.

\begin{longtable}{ | p{0.2\textwidth} | p{0.4\textwidth} | p{0.3\textwidth} |}
    \hline
    \cellcolor{blue!25}Drift type & \cellcolor{blue!25}Description & \cellcolor{blue!25}Dataset example\\
    \hline
    Data drift & Changes in the distributions of the ingested data over time that eventually significantly differ from the model's training data \autocite{datacamp_understanding_nodate}.
    & In this dataset, interest rates and people's yearly income may change as time passes or economic inflation occurs.\\
    \hline
    Concept drift & Changes in the relationship between the input and target variables \autocite{nigenda_amazon_2022}. 
    & In this dataset, this is somewhat unlikely. However, it could occur if there is a significant housing or job market crash 
    that would cause more people to need loans, which would change the original relationships.\\
    \hline
\caption{The common types of model drift.}\label{tab:Drift}
\end{longtable}

\pagebreak % It's just barely on the same page as the table but I don't want it to be.
\para Model drift can be a significant issue that greatly impacts the performance of ML models if it is not quickly noticed, and can 
also be an ethical concern if the model is being used to influence decisions such as granting loans in this project. 
Therefore, combatting model drift through methods such as continuous monitoring is necessary to ensure that the model remains accurate 
and usable. This can be accomplished in this project through MLFlow's monitoring dashboard.

% REVIEW TASK SHEETS 2, 3 AND 4.
% NOT SURE OF THE SEQUENCE OF 3 AND 4, CHECK EXAMPLE WORK.
% Example 2 (SimonRoadknight) is 21,334 words, or 18,809 without its appendices and references.
% Example 3 (MihaiValentin) is 12,802 words.



\include{SoftwareInit}
% Elements of SoftwareInit could be placed in the appropriate pipeline section.

% Not sure if you'll eventually face the Flask error with FastAPI. Its fix involved uninstalling and reinstalling Flask.


\section{Data Ingestion}\label{sec:ImpIngestion}
% Redis had to be reinstalled with Pip rather than Conda because it wasn't being recognised.
% This may have consequences later.

% Columnstore is 172.10.0.3, whereas Redis is 172.10.0.2.
% Your prototypes in the .ipynb do not get put here. Instead, ensure that they all work in there but then convert them 
% to Airflow DAGs. This means that all five of these sections simply can't be written until you do DAG conversion.

% It's up to you how you do the DAGs. I think all of your functions go into respective files and are imported to Pipeline.py.
% From there, create individual tasks for each function. Look into Task Groups to then group said individual tasks into Ingestion, Preprocessing, etc.


\section{Data Preprocessing}\label{sec:ImpPreprocessing}

\section{Model Development}\label{sec:ImpDevelopment}

\section{Model Deployment}\label{sec:ImpDeployment}

\section{Model Evaluation}\label{sec:ImpEvaluation}

\section{Potential security enhancements}\label{sec:SecurityEnhancements}

\section{Development challenges and future improvements}
During the implementation of the pipeline, it was discovered that many of PyArrow's useful functions are now 
deprecated. This made serializing data much harder, and for this reason an alternative package was identified:
Direct-Redis. Direct-Redis builds on top of the Redis package, but will instantly serialize and deserialize data 
when set() or get() is called, greatly expediting the process of storing data in and retrieving data from Redis
\autocite{direct-redis_direct-redis_nodate}.

\para Additionally, during the preprocessing stage, a minor improvement could have been made by also using a 
label encoder on the "previous\_loan\_defaults\_on\_file" column, as this column can only be "No" or "Yes", 
indicating an ordinal type that was originally misidentified. This will be resolved in the final version 
of the pipeline.

\chapter*{Conclusion}
\addcontentsline{toc}{chapter}{Conclusion}
% REWRITE THE INTRODUCTION AFTER THIS.

% =========================================================================
% MAIN NOTES:
% 
% You need to put figures of all these screenshots in that were taken last night.
% That's screenshots from the following folders:
%   Entire .Code folder   
%   Airflow/DAGs folder
%   Conda/DirectRedis and Conda/ImbalancedLearn.   
%   Entire FastAPI+Uvi folder
%   MLFlow/Other folder.
%
% Your ingestion isn't really ingesting. Import Kaggle and download + extract the zip.
% Section on future improvements. Notably you didn't recognise Previous Loan Defaults as ordinal, where LabelEncoding would've been better.
% Detailed description on why Arrow didn't work and why Direct-Redis did. Why is Direct-Redis a pip install?
% Add a BashOperator for mlflow ui.
% =========================================================================
\include{AppendixA}


\printbibliography

\end{document}

